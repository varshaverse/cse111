<!DOCTYPE html>
<html>
<head>
    <title>Patient Lookup</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

    <style>
        .lookup-container {
            width: 60%;
            margin: auto;
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            margin-top: 40px;
        }
        .lookup-title {
            font-size: 28px;
            color: #0f8975;
            text-align: center;
            margin-bottom: 20px;
        }

        .result-card {
            margin-top: 25px;
            background: #f9fffd;
            padding: 20px;
            border-left: 6px solid #0f8975;
            border-radius: 10px;
        }
        .no-result {
            margin-top: 20px;
            color: red;
            text-align: center;
            font-size: 18px;
        }
        .back-btn {
            margin-top: 20px;
            display: inline-block;
            text-decoration: none;
            background-color: #0f8975;
            color: white;
            padding: 10px 18px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
        }
        .back-btn:hover {
            background-color: #0c6f5e;
        }
        h3.section-heading {
            color: #0f8975;
            margin-top: 20px;
        }
    </style>
</head>

<body>

<div class="lookup-container">

    <div class="lookup-title">üîç Patient Lookup</div>

    <form method="POST" style="text-align:center;">
        <input type="text" name="mrn" placeholder="Enter Medical Record Number" required>
        <br>
        <button type="submit">Search</button>
    </form>

    {% if patient %}
    <div class="result-card">
        <h2 style="color:#0f8975;">Patient Found</h2>

        <p><strong>MRN:</strong> {{ patient.medical_record_number }}</p>
        <p><strong>Birth Year:</strong> {{ patient.birth_year }}</p>
        <p><strong>Gender:</strong> {{ patient.gender }}</p>
        <p><strong>Blood Type:</strong> {{ patient.blood_type }}</p>

        <hr style="margin:20px 0;">

        <!-- CONDITIONS -->
        <h3 class="section-heading">Conditions</h3>
        {% if conditions %}
            <ul>
                {% for c in conditions %}
                    <li>
                        <strong>{{ c.condition_name }}</strong>
                        (diagnosed {{ c.diagnosis_date }}) ‚Äì {{ c.doctor_name }}
                        {% if c.medications_for_condition %}
                            <br>
                            <em>Medications used for this condition:
                                {{ c.medications_for_condition }}
                            </em>
                        {% endif %}
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p>No documented conditions for this patient.</p>
        {% endif %}

        <!-- MEDICATIONS -->
        <h3 class="section-heading">Medications</h3>
        {% if medications %}
            <ul>
                {% for m in medications %}
                    <li>
                        <strong>{{ m.medication_name }}</strong>
                        (prescribed {{ m.prescription_date }}) ‚Äì {{ m.doctor_name }}
                        {% if m.conditions_for_medication %}
                            <br>
                            <em>Treats: {{ m.conditions_for_medication }}</em>
                        {% endif %}
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p>No active medications found.</p>
        {% endif %}

        <!-- VACCINES -->
        <h3 class="section-heading">Vaccines</h3>
        {% if vaccines %}
            <ul>
                {% for v in vaccines %}
                    <li>
                        <strong>{{ v.vaccine_name }}</strong>
                        ({{ v.admin_date }})
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p>No vaccine records found.</p>
        {% endif %}
    </div>
    {% endif %}

    {% if patient is none and request.method == 'POST' %}
    <div class="no-result">‚ùå No patient found with that MRN.</div>
    {% endif %}

    <a href="/doctor_dashboard" class="back-btn">‚¨Ö Back to Dashboard</a>

</div>

</body>
</html>
